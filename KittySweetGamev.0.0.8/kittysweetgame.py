"""
GAME: KITTY SWEET GAME

AUTHOR: LILYKPROGRAMMING

AUTHOR-IMAGE:
AUTHOR FREEPIK - 'catalyststuff': https://pl.freepik.com/autor/catalyststuff
AUTHOR BRGFX - https://pl.freepik.com/autor/brgfx
'cat_eat_fish.bmp': https://pl.freepik.com/darmowe-wektory/ladny-kot-jedzenie-ryb-ilustracja-kreskowka-wektor_11056516.htm#query=cartoon%20cat&position=42&from_view=search&track=ais"
'cat_info.bmp': https://pl.freepik.com/darmowe-wektory/ladny-kot-trzymajacy-mlotek-kreskowka-wektor-ikona-ilustracja-zwierzeca-natura-ikona-koncepcja-na-bialym-tle-plaski_40915519.htm#query=cartoon%20cat&position=23&from_view=search&track=ais
'cat_man.bmp': https://pl.freepik.com/darmowe-wektory/ladny-zly-kot-na-sobie-garnitur-i-okulary-przeciwsloneczne-z-kij-baseballowy-kreskowka-ikona-ilustracja-koncepcja-ikona-moda-zwierzat-na-bialym-tle-plaski-styl-kreskowki_10909204.htm#query=cartoon%20cat&position=10&from_view=search&track=ais
'cat_with_bubble_tea.bmp': https://pl.freepik.com/darmowe-wektory/slodki-kot-pic-herbate-mleczna-boba-kreskowka-wektor-ikona-ilustracja-zwierzat-napoj-ikona-koncepcja-bialym_29084483.htm#query=cartoon%20cat%20bubble%20tea&position=0&from_view=search&track=ais
'eat_cat.bmp': https://pl.freepik.com/darmowe-wektory/ladny-kot-trzymajac-rybe-ikona-ilustracja-kreskowka-koncepcja-ikona-zywnosci-dla-zwierzat-na-bialym-tle-plaski-styl-kreskowki_10909207.htm#query=cartoon%20cat%20fish&position=42&from_view=search&track=ais
'love_cat.bmp': https://pl.freepik.com/darmowe-wektory/ladny-kot-z-milosci-znak-recznie-ilustracja-kreskowka-pojecie-natury-zwierzecej-na-bialym-tle-plaski-styl-kreskowki_16424083.htm#query=cartoon%20cat%20love&position=13&from_view=search&track=ais
'sad_cat.bmp': https://pl.freepik.com/darmowe-wektory/ladny-czarny-kotek-w-siedzacej-pozie_43941387.htm#query=cartoon%20cat&position=33&from_view=search&track=ais
'sit_cat.bmp': https://pl.freepik.com/darmowe-wektory/ladny-kot-siedzacy-kreskowka-wektor-ikona-ilustracja-zwierzeca-natura-ikona-koncepcja-bialym-tle-premium-wektor-plaski-styl-kreskowki_22638092.htm#query=cartoon%20cat%20sit&position=4&from_view=search&track=ais
'sleep_bed_cat.bmp': https://pl.freepik.com/darmowe-wektory/slodki-kot-spi-na-poduszce-kreskowka-wektor-ikona-ilustracja-zwierze-natura-ikona-koncepcja-na-bialym-tle_28565559.htm#query=cartoon%20cat%20bed%20sleep&position=18&from_view=search&track=ais
'sleep_cat.bmp': https://pl.freepik.com/darmowe-wektory/ladny-kot-spi-na-poduszce-ikona-ilustracja-kreskowka-koncepcja-ikona-milosci-zwierzat-na-bialym-tle-plaski-styl-kreskowki_10909210.htm#query=cartoon%20cat%20bed%20sleep&position=8&from_view=search&track=ais
'sad_cry_cat.bmp': https://www.freepik.com/free-vector/cute-cat-crying-cartoon-vector-icon-illustration-animal-nature-icon-concept-isolated-premium-vector_30924706.htm#query=cartoon%20cat%20sad&position=0&from_view=search&track=ais
'thinking_cat.bmp': https://www.freepik.com/free-vector/cute-cool-cat-wearing-eyeglasses-hoodie-cartoon-vector-icon-illustration-animal-fashion-icon-concept-isolated-premium-vector-flat-cartoon-style_23006693.htm#query=cartoon%20cat&position=5&from_view=keyword&track=ais
'happy_cat.bmp': https://www.freepik.com/free-vector/8400-6-205_43397948.htm#query=cartoon%20cat%20happy&position=2&from_view=search&track=ais
'dubbing_cat.bmp': https://www.freepik.com/free-vector/cute-cat-dabbing-cartoon-icon-illustration-animal-nature-icon-isolated-flat-cartoon-style_13851671.htm#query=cartoon%20cat%20happy&position=22&from_view=search&track=ais
'chill_out_cat.bmp': https://www.freepik.com/free-vector/cute-happy-cat-laying-cartoon-vector-icon-illustration-animal-nature-icon-concept-isolated-premium-vector-flat-cartoon-style_18790561.htm#query=cartoon%20cat%20happy&position=26&from_view=search&track=ais

AVATAR CAT: https://pixabay.com/pl/vectors/kot-zwierz%C4%99-domowe-kotek-koci-6645688/
AUTHOR AVATAR CAT: https://pixabay.com/pl/users/resampled-9479920/
AVATAR MOUSE: https://clipart-library.com/clip-art/mouse-clipart-transparent-25.htm
AVATAR CUCUMBER: https://pixabay.com/pl/vectors/og%C3%B3rek-owoc-jedzenie-zielony-oczy-6474473/
AUTHOR AVATAR CUCUMBER: https://pixabay.com/pl/users/klauxla-21683229/

BUTTONS:
Buttons create with https://www.canva.com/

FONTS:
https://fonts.google.com/

FACTS ABOUT CATS:
https://www.funkidslive.com/learn/top-10-facts/top-10-facts-about-cats/

INSPIRATIONS:
https://pythonprogramming.altervista.org/buttons-in-pygame/
https://www.pygame.org/news
https://pythontutor.com/python-debugger.html#mode=edit
https://realpython.com/pygame-a-primer/
https://realpython.com/
TOP INSPIRATION: https://realpython.com/top-python-game-engines/

MUSIC:
https://voicebot.su/pl/category/myszy/
https://ncs.io/seconds
https://www.youtube.com/watch?v=_HnSdwaZ-5w&ab_channel=Voicians

BUTTONS, TEXT, ICON
https://www.canva.com/
"""

#Import and initialization library sys
import sys
#Import and initialization library pygame.
import pygame
#Import and initialization library random.
from random import randint
#Import and initialization library pathlib.
from pathlib import Path
#Import module mechanic
import mechanic
#Import module classes
import classes as c
#Import module elements
import elements as e
#Import module functions
import functions as fun

#PROGRAM START
pygame.init()
#MUSIC SETTINGS
pygame.mixer.music.load(e.music_path)
music = pygame.mixer.Sound(e.music_path)
pygame.mixer.music.play(-1)
pygame.mixer.music.set_volume(0.3)

pygame.time.set_timer(mechanic.ADD_MOUSE, mechanic.countdown_mouse)
pygame.time.set_timer(mechanic.ADD_CUCUMBER, mechanic.countdown_cucumber)
mouse_sound = pygame.mixer.Sound(
    str(Path.cwd() / "primer" / "sounds" / "mouse_sound.wav")
)

#PLAYER
player= c.Player()
player.update(pygame.mouse.get_pos())

def show_running_screen_function():
    #WHILE MECHANIC.RUNNING GAME
    while mechanic.running:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
                print("QUIT GAME")
                sys.exit()
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = pygame.mouse.get_pos()
                #BUTTON EXIT
                if mechanic.exit_rect.collidepoint(x, y):
                        mechanic.running = False
                        pygame.quit()
                        print("QUIT GAME")
                        save_scores_to_file()
                        sys.exit()
                if mechanic.pause_rect.collidepoint(x, y):
                        mechanic.running = False
                        show_continue_screen_function()
            elif event.type == mechanic.ADD_MOUSE:
                new_mouse = c.Mouse()
                mechanic.list_mouse.add(new_mouse)
                if len(mechanic.list_mouse) < 3:
                    mechanic.countdown_mouse -= mechanic.range_mouse
                if mechanic.countdown_mouse < 100:
                    mechanic.countdown_mouse = 100
                pygame.time.set_timer(mechanic.ADD_MOUSE, mechanic.countdown_mouse)
            elif event.type == mechanic.ADD_CUCUMBER:
                new_cucumber = c.Cucumber()
                mechanic.list_cucumber.add(new_cucumber)
                if len(mechanic.list_cucumber) < 3:
                    mechanic.countdown_cucumber -= mechanic.range_cucumber
                if mechanic.countdown_cucumber < 100:
                    mechanic.countdown_cucumber = 100
                pygame.time.set_timer(mechanic.ADD_CUCUMBER, mechanic.countdown_cucumber)
        #PLAYER UPDATE
        player.update(pygame.mouse.get_pos())
        pick_mouse = pygame.sprite.spritecollide(
            sprite=player, group=mechanic.list_mouse, dokill=True
        )
        pick_cucumber = pygame.sprite.spritecollide(
            sprite=player, group=mechanic.list_cucumber, dokill=True
        )
        for mouses in pick_mouse:
            mechanic.points += 5
            mouse_sound.play()
        for cucumbers in pick_cucumber:
            mechanic.points += 5

        if len(mechanic.list_mouse) > mechanic.number_of_mouse:
            mechanic.running = False
            mechanic.show_end_screen = True
            show_end_screen_function()
        if len(mechanic.list_cucumber) > mechanic.number_of_cucumber:
            mechanic.running = False
            mechanic.show_end_screen = True
            show_end_screen_function()
        #SCREEN BLIT
        e.screen_game.fill((246, 80, 160))
        for mouses in mechanic.list_mouse:
            e.screen_game.blit(mouses.surf, mouses.rect)
        for cucumbers in mechanic.list_cucumber:
            e.screen_game.blit(cucumbers.surf, cucumbers.rect)
        #SCREEN BLIT
        e.screen_game.blit(player.surf, player.rect)

        #TEXT
        font_title = pygame.font.Font("primer/fonts/BigShouldersDisplay-Light.ttf", 100)
        title_text = font_title.render('KITTY SWEET GAME',False, mechanic.white)
        title_rect = title_text.get_rect(center=(mechanic.HEIGHT//2,mechanic.WIDTH//9))
        e.screen_game.blit(title_text, title_rect)
        #SCORE FONT AND BLOCK
        score_font = pygame.font.Font("primer/fonts/OpenSans_Condensed-Bold.ttf",50)
        score_block = score_font.render(f"Points: {mechanic.points}", False, mechanic.white)
        #SCREEN BLIT
        e.screen_game.blit(score_block, (40, mechanic.WIDTH - 80))
        e.screen_game.blit(mechanic.exit_image, mechanic.exit_rect)
        e.screen_game.blit(mechanic.pause_image, mechanic.pause_rect)
        pygame.display.update() 
        #OPEN FILE SCORES.TXT
def save_scores_to_file():
    with open("primer/documents/scores.txt","a") as add_points:
            add_points.write(str(mechanic.points)+ "\n")          
def show_end_screen_function(): 
    #WHILE MECHANIC.SHOW_END_SCREEN
    while mechanic.show_end_screen:
        if mechanic.contents_file_number < mechanic.points:
                        mechanic.save_highest_score = mechanic.points
                        with open("primer/documents/highest_score.txt", "w") as highest_score1:
                            highest_score1.write(str(mechanic.save_highest_score))
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                mechanic.running = False
                pygame.quit()
                print("QUIT GAME")
                save_scores_to_file()
                sys.equit()
                #BUTTONS
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = pygame.mouse.get_pos()
                #BUTTON TRY_AGAIN
                if mechanic.try_again_rect.collidepoint(x, y):
                    save_scores_to_file()
                    mechanic.show_end_screen = False
                    show_running_screen_function()
                    mechanic.running = True
                    mechanic.points = 0
                    mechanic.list_mouse.empty()
                    mechanic.countdown_mouse = 2500
                    player.reset_position((mechanic.initial_x, mechanic.initial_y))
                    for _ in range(mechanic.number_of_mouse):
                        new_mouse = c.Mouse() 
                        new_mouse.reset_position()
                #BUTTON EXIT    
                elif mechanic.exit_rect.collidepoint(x, y):
                    mechanic.running = False
                    pygame.quit()
                    print("QUIT GAME")
                    save_scores_to_file()
                    sys.exit()
                elif mechanic.return_start_rect.collidepoint(x, y):
                    print("BACT TO START")
                    save_scores_to_file()
                    mechanic.show_end_screen = False
                    mechanic.running = True
                    mechanic.points = 0
                    mechanic.list_mouse.empty()
                    mechanic.countdown_mouse = 2500
                    player.reset_position((mechanic.initial_x, mechanic.initial_y))
                    for _ in range(mechanic.number_of_mouse):
                        new_mouse = c.Mouse() 
                        new_mouse.reset_position()
                    show_start_screen_function()
        fun.style_end_screen(mechanic.points,mechanic.save_highest_score)
        #SCREEN BLIT
        e.screen_game.blit(mechanic.exit_image, mechanic.exit_rect)
        e.screen_game.blit(mechanic.return_start_image, mechanic.return_start_rect)
        e.screen_game.blit(mechanic.try_again_image, mechanic.try_again_rect)
        pygame.display.update()
        #CLOCK TICK
        e.clock_game.tick(30)
def show_continue_screen_function():
    while True:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                mechanic.running = False
                pygame.QUIT
                print("QUIT GAME")
                save_scores_to_file()
                sys.exit()
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = pygame.mouse.get_pos()
                #BUTTONS
            #BUTTON START
                if mechanic.con_game_rect.collidepoint(x, y):
                    mechanic.running = True
                    show_running_screen_function()
                elif mechanic.exit_rect.collidepoint(x, y):
                    mechanic.running = False
                    pygame.quit()
                    print("QUIT GAME")
                    save_scores_to_file()
                    sys.exit()
                elif mechanic.current_image_rect_2.collidepoint(x, y):
                    if mechanic.of_after_click:
                        pygame.mixer.music.pause()
                        mechanic.of_after_click = False
                        mechanic.current_image = mechanic.continue_song_image
                    else:
                        pygame.mixer.music.unpause()
                        mechanic.of_after_click = True
                        mechanic.current_image = mechanic.mute_image
        fun.style_continue_screen()
        #SCREEN BLIT
        e.screen_game.blit(mechanic.con_game_image, mechanic.con_game_rect)
        #e.screen_game.blit(mechanic.return_start_image, mechanic.return_start_rect)
        e.screen_game.blit(mechanic.exit_image, mechanic.exit_rect)
        e.screen_game.blit(mechanic.current_image, mechanic.current_image_rect_2)
        pygame.display.update()  
def show_info_screen_function():
    #WHILE MECHANIC.SHOW_INFO_SCREEN
    while True:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                mechanic.running = False
                mechanic.show_info_screen = False
                print("QUIT GAME")
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = pygame.mouse.get_pos()
                #BUTTONS
                #BUTTON START
                if mechanic.start_rect_info.collidepoint(x, y):
                    show_running_screen_function()
                    print("BACT TO START")
                    mechanic.running = True
                elif mechanic.exit_rect.collidepoint(x, y):
                    mechanic.running = False
                    mechanic.show_start_screen = False
                    pygame.quit()
                    print("QUIT GAME")
                    sys.exit()
                elif mechanic.return_start_rect.collidepoint(x, y):
                    print("BACT TO START")
                    show_start_screen_function()
        fun.style_info_screen()
        #SCREEN BLIT
        e.screen_game.blit(mechanic.cat_info_image,(850,600))
        e.screen_game.blit(mechanic.cat_eat_fish_image,(-50,400))
        e.screen_game.blit(mechanic.start_image_info, mechanic.start_rect_info)
        e.screen_game.blit(mechanic.return_start_image, mechanic.return_start_rect)
        e.screen_game.blit(mechanic.exit_image, mechanic.exit_rect)
        pygame.display.update()
def show_settings_screen_function():
    #WHILE SHOW_SETTINGS_SCREEN
    while True:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                mechanic.running = False
                mechanic.show_info_screen = False
                print("QUIT GAME")
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = pygame.mouse.get_pos()
                #BUTTONS
                #BUTTON START
                if mechanic.start_rect_info.collidepoint(x, y):
                    show_running_screen_function()
                    mechanic.running = True
                elif mechanic.exit_rect.collidepoint(x, y):
                    pygame.quit()
                    print("QUIT GAME")
                    sys.exit()
                elif mechanic.return_start_rect.collidepoint(x, y):
                    print("BACT TO START")
                    show_start_screen_function()
                elif mechanic.current_image_rect_2.collidepoint(x, y):
                    if mechanic.of_after_click:
                        pygame.mixer.music.pause()
                        mechanic.of_after_click = False
                        mechanic.current_image = mechanic.continue_song_image
                    else:
                        pygame.mixer.music.unpause()
                        mechanic.of_after_click = True
                        mechanic.current_image = mechanic.mute_image
        fun.style_settings_screen()
        #SCREEN BLIT
        e.screen_game.blit(mechanic.cat_man_image,(850,600))
        e.screen_game.blit(mechanic.love_cat_image,(-50,300))
        e.screen_game.blit(mechanic.sit_cat_image,(1200,100))
        e.screen_game.blit(mechanic.start_image_info, mechanic.start_rect_info)
        e.screen_game.blit(mechanic.current_image, mechanic.current_image_rect_2)
        #e.screen_game.blit(mechanic.current_image_2, mechanic.current_image_rect_2)
        e.screen_game.blit(mechanic.return_start_image, mechanic.return_start_rect)
        e.screen_game.blit(mechanic.exit_image, mechanic.exit_rect)
        pygame.display.update()
def calculate_total_scores():
    total_score = 0
    try:
        with open("primer/documents/scores.txt", "r") as scores_file:
            lines = scores_file.readlines()
            for line in lines:
                try:
                    score = int(line.strip())
                    total_score += score
                except ValueError:
                    print(f"Calculate_total_scores correct")
            return total_score
    except FileNotFoundError:
        print("File not found.")
        return 0
def show_start_screen_function():
    while True:
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                mechanic.running = False
                mechanic.show_start_screen = False
                print("QUIT GAME")
            #BUTTONS
            elif event.type == pygame.MOUSEBUTTONDOWN:
                x, y = pygame.mouse.get_pos()
            #BUTTON START
                if mechanic.start_rect.collidepoint(x, y):
                    show_running_screen_function()
                #BUTTON EXIT
                elif mechanic.exit_rect.collidepoint(x, y):
                    mechanic.running = False
                    mechanic.show_start_screen = False
                    pygame.quit()
                    print("QUIT GAME")
                    sys.exit()
            #BUTTON INFO
                if mechanic.info_rect.collidepoint(x,y):
                    show_info_screen_function()
                #BUTTON SETTINGS
                elif mechanic.settings_rect.collidepoint(x, y):
                    show_settings_screen_function()
                    #BUTTON CURRENT
                elif mechanic.current_image_rect.collidepoint(x, y):
                    if mechanic.of_after_click:
                        pygame.mixer.music.pause()
                        mechanic.of_after_click = False
                        mechanic.current_image = mechanic.continue_song_image
                    else:
                        pygame.mixer.music.unpause()
                        mechanic.of_after_click = True
                        mechanic.current_image = mechanic.mute_image
        fun.style_start_screen()
    #VALUE 
        total_scores = calculate_total_scores()
    #FONT
        font = pygame.font.SysFont(None, 30)
        font_total_scores = pygame.font.Font("primer/fonts/Aleo-Regular.ttf", 50)
        text_total_scores = font_total_scores.render(f'Total scores: {total_scores}', False, mechanic.white)
    #SCREEN BLIT
        e.screen_game.blit(mechanic.avatar_her_image,(20,900))
    #TRANSFORM SCALE SIGNATURE_TEXT_IMAGE
        mechanic.signature_text_image = pygame.transform.scale(mechanic.signature_text_image, (200,40))
        mechanic.cat_with_bubble_tea_image = pygame.transform.scale(mechanic.cat_with_bubble_tea_image, (800,700))
    #SCREEN BLIT
        e.screen_game.blit(text_total_scores, (1200, 150))
        e.screen_game.blit(mechanic.signature_text_image,(110,960))
        e.screen_game.blit(mechanic.cat_with_bubble_tea_image,(1190,450))
        e.screen_game.blit(mechanic.sleep_cat_image,(400,-150))
        e.screen_game.blit(mechanic.sleep_bed_cat_image,(-50,400))
        font_result = pygame.font.Font("primer/fonts/Aleo-Regular.ttf", 60)
        text_result = font_result.render('Highest score!', False,mechanic.white)
        e.screen_game.blit(text_result, (20,30))
    #TEXT
        font_result_1 = pygame.font.Font("primer/fonts/Aleo-Bold.ttf",40)
        text_result_1 = font_result_1.render(f"{mechanic.contents_file} scores!",False, mechanic.white)
    #SCREEN BLIT
        e.screen_game.blit(text_result_1,(30,100))
        e.screen_game.blit(mechanic.info_image, mechanic.info_rect)
        e.screen_game.blit(mechanic.start_image, mechanic.start_rect)
        e.screen_game.blit(mechanic.current_image, mechanic.current_image_rect)
        e.screen_game.blit(mechanic.settings_image, mechanic.settings_rect)
        e.screen_game.blit(mechanic.exit_image, mechanic.exit_rect)
        pygame.display.update() 
    #PROGRAM END
show_start_screen_function()